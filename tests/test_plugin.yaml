---
- case: positional_only
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |
    def func(a: int, /, b: str = "default") -> None: ...
    func(1)

- case: positional
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |
    def func(a: int) -> None: ...
    func(1)
  out: |
    main:2: error: Too many positional arguments for "func"  [misc]

- case: positional_optional
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |
    def func(a: int = 1) -> None: ...
    func(1)
    func()
  out: |
    main:2: error: Too many positional arguments for "func"  [misc]

- case: keyword_only
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |
    def func(*, a: int) -> None: ...
    func(a=1)

- case: keyword_only_optional
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |
    def func(*, a: int = 1) -> None: ...
    func(a=1)
    func()

- case: var_positional
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |
    def func(*args: str) -> None: ...
    func("extra")

- case: var_keyword
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |
    def func(**kwargs: str) -> None: ...
    func(a="extra")

- case: positional_followed_by_var_positional
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |
    def func(a: int, *args: str) -> None: ...
    func(1)

- case: positional_optional_followed_by_var_positional
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |
    def func(a: int = 1, *args: str) -> None: ...
    func(1)
    func()

- case: positional_followed_by_var_keyword
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |
    def func(a: int, **kwargs: str) -> None: ...
    func(1)
  out: |
    main:2: error: Too many positional arguments for "func"  [misc]

- case: var_positional_followed_by_keyword
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |
    def func(*args: str, a: int) -> None: ...
    func("a", a=1)

- case: method
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |-
    class C:
        def __init__(self) -> None: ...

        def method(self, a: int) -> None: ...

    c = C()
    c.method(1)
  out: |-
    main:7: error: Too many positional arguments for "method" of "C"  [misc]

- case: callable_class_as_decorator
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |-
    from typing import Any

    class C:
        def __call__(self, func: Any) -> None: ...

    @C()
    def func() -> None: ...

- case: callable_class_extra_params
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |-
    from typing import Any

    class C:
        def __call__(self, func: Any, a: int) -> None: ...

    c = C()
    c(lambda: None, 1)
    c(func=lambda: None, a=1)
    c(lambda: None, a=1)
  out: |-
    main:7: error: Too many positional arguments for "__call__" of "C"  [misc]

- case: descriptor
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |-
    class D:
      def __get__(self, o: object, ot: type | None = None) -> None:
          return

      def __set__(self, o: object, v: int) -> None:
          return

    class C:
        a = D()

    c = C()
    c.a
    c.a = 1

- case: ignore_name
  files:
    - path: pyproject.toml
      content: |
        [tool.mypy]
        plugins = ["mypy_strict_kwargs"]

        [tool.mypy_strict_kwargs]
        ignore_names = ["main.func", "builtins.str"]
  main: |-
    def func(a: int) -> None: ...
    func(1)

    def not_ignored(a: int) -> None: ...
    not_ignored(1)

    str(1)
  out: |-
    main:5: error: Too many positional arguments for "not_ignored"  [misc]

# This does not actually test the debug option, but it gives
# us coverage at least.
- case: debug
  files:
    - path: pyproject.toml
      content: |
        [tool.mypy]
        plugins = ["mypy_strict_kwargs"]

        [tool.mypy_strict_kwargs]
        ignore_names = ["main.func", "builtins.str"]
        debug = true
  main: |-
    def func(a: int) -> None: ...
    func(1)

    def not_ignored(a: int) -> None: ...
    not_ignored(1)

    str(1)
  out: |-
    main:5: error: Too many positional arguments for "not_ignored"  [misc]

- case: ignore_name_ini
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs

    [mypy_strict_kwargs]
    ignore_names = main.func, builtins.str
  main: |-
    def func(a: int) -> None: ...
    func(1)

    def not_ignored(a: int) -> None: ...
    not_ignored(1)

    str(1)
  out: |-
    main:5: error: Too many positional arguments for "not_ignored"  [misc]

# This does not actually test the debug option, but it gives
# us coverage at least.
- case: debug_ini
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs

    [mypy_strict_kwargs]
    ignore_names = main.func, builtins.str
    debug = true
  main: |-
    def func(a: int) -> None: ...
    func(1)

    def not_ignored(a: int) -> None: ...
    not_ignored(1)

    str(1)
  out: |-
    main:5: error: Too many positional arguments for "not_ignored"  [misc]

- case: ignore_name_ini_no_spaces
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs

    [mypy_strict_kwargs]
    ignore_names = main.func,builtins.str
  main: |-
    def func(a: int) -> None: ...
    func(1)

    def not_ignored(a: int) -> None: ...
    not_ignored(1)

    str(1)
  out: |-
    main:5: error: Too many positional arguments for "not_ignored"  [misc]

# Test when no mypy_strict_kwargs section exists - plugin should work with defaults
- case: no_plugin_section_ini
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs
  main: |-
    def func(a: int) -> None: ...
    func(1)
  out: |-
    main:2: error: Too many positional arguments for "func"  [misc]

# Test when ignore_names is empty
- case: empty_ignore_names_ini
  mypy_config: |
    [mypy]
    plugins = mypy_strict_kwargs

    [mypy_strict_kwargs]
    ignore_names =
  main: |-
    def func(a: int) -> None: ...
    func(1)
  out: |-
    main:2: error: Too many positional arguments for "func"  [misc]

- case: ignore_name_dot_mypy_ini
  files:
    - path: .mypy.ini
      content: |
        [mypy]
        plugins = mypy_strict_kwargs

        [mypy_strict_kwargs]
        ignore_names = main.func, builtins.str
  main: |-
    def func(a: int) -> None: ...
    func(1)

    def not_ignored(a: int) -> None: ...
    not_ignored(1)

    str(1)
  out: |-
    main:5: error: Too many positional arguments for "not_ignored"  [misc]

- case: ignore_name_setup_cfg
  files:
    - path: setup.cfg
      content: |
        [mypy]
        plugins = mypy_strict_kwargs

        [mypy_strict_kwargs]
        ignore_names = main.func, builtins.str
  main: |-
    def func(a: int) -> None: ...
    func(1)

    def not_ignored(a: int) -> None: ...
    not_ignored(1)

    str(1)
  out: |-
    main:5: error: Too many positional arguments for "not_ignored"  [misc]

# This does not actually test the debug option, but it gives
# us coverage at least.
- case: debug_setup_cfg
  files:
    - path: setup.cfg
      content: |
        [mypy]
        plugins = mypy_strict_kwargs

        [mypy_strict_kwargs]
        ignore_names = main.func, builtins.str
        debug = true
  main: |-
    def func(a: int) -> None: ...
    func(1)

    def not_ignored(a: int) -> None: ...
    not_ignored(1)

    str(1)
  out: |-
    main:5: error: Too many positional arguments for "not_ignored"  [misc]
